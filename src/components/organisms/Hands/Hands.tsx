import React, {
  useRef,
  useEffect,
  useState,
  useCallback,
  FC,
} from 'react';

import styled from 'styled-components';
import gsap from 'gsap';
import { usePrevious } from 'hooks/usePrevious';
import { getSeparateFingers } from './utils';

const WrapperSVG = styled.svg`
  max-width: 100%;
  #fingers ~ path {
    fill: ${({ theme }) => theme.color.brand[0]};
  }
`;
interface HandsProps {
  activeFinger: number;
}
export const Hands: FC<HandsProps> = ({ activeFinger = 6 }) => {
  const wrapper = useRef<SVGSVGElement>(null);
  const prevActiveFinger = usePrevious(activeFinger);
  const [fingersNodeIds, setFingersNodesIds] = useState<any[]>([]);

  const setAsActive = useCallback((active, prevActive, nodes) => {
    if (prevActive) {
      gsap.set(`#${nodes[prevActive - 1]} > path`, {
        duration: 0.1,
        fill: '#4F4F4F',
      });
    }
    gsap.set(`#${nodes[active - 1]} > path`, {
      duration: 0.1,
      fill: 'green',
    });
  }, []);

  useEffect(() => {
    const el = wrapper.current;
    if (!el) return;

    const hands = [...el.querySelectorAll('#fingers, #fingers_2')];
    const [leftHand, rightHand] = getSeparateFingers(hands);
    const allFingers = [...leftHand, ...rightHand];

    setAsActive(activeFinger, null, allFingers);
    setFingersNodesIds(allFingers);
  }, [setAsActive, activeFinger]);

  useEffect(() => {
    const el = wrapper.current;
    if (el === null || fingersNodeIds.length === 0) return;

    setAsActive(activeFinger, prevActiveFinger, fingersNodeIds);
  }, [activeFinger, fingersNodeIds, prevActiveFinger, setAsActive]);

  return (
    <WrapperSVG
      width="602"
      height="192"
      viewBox="0 0 602 192"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      ref={wrapper}
    >
      <g id="Hands">
        <g id="right">
          <g id="restHand">
            <path
              id="Vector"
              d="M534.894 111.246C531.187 106.216 527.377 106.991 521.066 107.5C510.306 108.37 507.736 113.257 506.234 123.447C503.591 141.38 507.454 136.51 507.947 142.002C508.045 143.1 504.38 144.273 507.326 145.376C510.338 143.085 512.083 146.545 516.049 146.58C518.902 146.606 516.834 144.764 519.596 144.684C522.393 144.603 522.789 145.359 525.59 145.818C538.028 147.855 527.568 132.5 530.428 125.122C540.013 129.419 538.484 116.119 534.894 111.246Z"
              fill="#5C5C5C"
            />
            <path
              id="Vector_2"
              d="M462.418 92.1862C453.547 99.0054 458.775 101.976 458.186 107.211C457.869 110.033 457.103 110.624 456.404 113.243C454.331 121.007 457.633 123.199 458.618 130.112C459.714 137.811 459.514 140.167 468.691 143.076C477.915 145.686 488.656 144.347 488.506 133.903C488.489 132.66 486.628 131.933 486.864 129.497C487.032 127.77 490.269 126.831 490.641 124.52C490.941 122.658 485.565 113.633 487.303 112.866C491.086 111.197 494.731 116.995 494.347 110.154C494.29 109.143 491.389 103.324 490.857 102.448C488.839 99.1236 487.425 99.5093 487.02 96.4628C486.686 93.9384 490.17 92.0906 488.771 88.7466C485.736 81.4985 472.019 84.806 462.418 92.1862Z"
              fill="#5C5C5C"
            />
            <path
              id="Vector_3"
              d="M416.32 112.635C415.428 112.921 413.86 111.395 413.026 111.246C408.045 110.358 407.79 107.495 405.614 113.29C405.302 114.122 406.349 115.538 406.16 116.416C405.846 117.872 403.366 118.053 403.24 119.05C402.889 121.823 405.161 125.4 405.229 128.483C405.389 135.755 400.074 135.918 405.186 142.648C407.525 147.952 413.447 144.621 416.399 143.973C419.277 143.341 427.279 143.931 429.683 142.165C429.333 142.423 434.548 135.115 434.459 135.487C435.091 132.823 432.659 130.517 431.456 128.183C427.972 121.42 433.792 121.152 428.105 114.851C415.565 100.956 418.381 111.973 416.32 112.635Z"
              fill="#5C5C5C"
            />
          </g>
          <g id="fingers">
            <g id="finger">
              <path
                id="Vector_4"
                d="M570.577 100.53C570.326 105.082 569.723 106.114 573.798 109.422C576.827 111.88 578.36 110.61 581.762 112.495C585.095 114.343 583.966 117.907 587.092 119.119C595.639 122.734 609.163 73.8201 585.699 70.3468C579.568 69.4393 573.417 72.6336 571.639 78.7437C570.724 81.8908 572.926 96.1658 572.979 96.4653C572.29 97.8873 571.489 99.2421 570.577 100.53Z"
                fill="#383838"
              />
              <path
                id="Vector_5"
                d="M583.121 122.83C574.984 119.942 578.981 117.892 574.596 117.564C561.028 116.548 562.703 136.025 562.556 138.143C562.448 139.69 564.848 138.531 563.979 140.667C563.069 142.903 560.822 141.939 559.385 142.987C550.846 149.211 547.298 165.235 555.403 170.25C555.69 170.428 558.896 168.888 558.997 169.077C560.297 171.499 560.145 174.039 563.282 175.142C566.221 176.176 579.307 172.834 573.829 168.738C585.183 163.7 588.337 147.484 588.75 136.688C589.064 128.444 590.907 125.594 583.121 122.83Z"
                fill="#383838"
              />
            </g>
            <g id="finger_2">
              <path
                id="Vector_6"
                d="M515.403 52.5899C517.012 58.3195 514.412 57.6224 513.972 63.6296C513.575 69.0528 516.543 71.5893 513.623 76.7368C511.632 80.2458 509.746 81.7034 508.84 85.623C506.045 97.7136 512.569 95.0466 513.704 96.2229C516.453 99.0721 514.584 108.383 527.005 104.69C528.462 104.257 528.894 102.459 530.191 102.326C532.945 102.046 537.506 104.786 540.076 103.447C544.916 100.926 541.386 94.5355 541.902 90.9385C542.645 85.7615 546.409 82.3059 545.67 76.7874C544.38 67.1589 540.127 69.5923 533.384 66.7387C531.806 66.0706 530.089 63.6197 528.906 63.2526C527.555 62.8335 523.021 64.1384 522.311 63.4383C519.057 60.2291 527.968 60.7824 528.321 60.847C537.24 62.4826 547.721 67.5109 544.417 26.6053C543.019 9.30726 506.043 -0.642881 511.37 36.7095C512.147 42.1551 513.9 47.2387 515.403 52.5899Z"
                fill="#383838"
              />
            </g>
            <g id="finger_3">
              <path
                id="Vector_7"
                d="M456.843 44.7398C457.829 45.285 462.71 44.91 462.712 44.8963C462.584 46.0408 458.564 48.6819 457.788 50.2532C455.995 53.8843 457.117 60.498 456.85 63.059C456.772 63.8071 454.845 64.4698 454.786 65.3292C454.506 69.476 458.738 83.6927 461.965 85.5437C464.851 87.18 465.385 84.9739 467.685 84.5897C481.613 82.2662 487.516 85.0667 485.898 70.858C485.18 64.5606 488.319 59.1684 486.889 51.4871C483.88 35.3211 477.347 42.7127 475.138 39.3555C474.89 38.9785 482.734 33.0023 483.891 30.9107C489.897 20.0528 485.106 6.40855 480.852 4.19664C478.636 3.04447 471.273 3.59711 468.517 3.50894C446.276 2.79603 451.845 41.9739 456.843 44.7398Z"
                fill="#383838"
              />
            </g>
            <g id="finger_4">
              <path
                id="Vector_8"
                d="M407.566 69.7218C415.937 73.9673 426.92 64.1573 428.088 55.9465C428.689 51.7216 426.686 45.9624 426.51 41.2069C426.365 37.2919 425.384 27.6253 421.516 25.0626C418.804 23.2662 409.926 25.7336 407.16 26.9142C401.345 29.3951 399.955 33.316 396.771 38.9862C392.842 45.9834 393.683 48.5085 396.26 56.6442C398.196 62.758 399.004 63.8157 404.49 66.0165C403.863 65.765 408.132 69.9321 407.566 69.7218Z"
                fill="#383838"
              />
              <path
                id="Vector_9"
                d="M397.971 90.0657C396.022 100.194 401.501 111.077 407.263 102.75C411.151 110.248 422.414 105.838 426.342 100.66C428.743 97.4954 428.541 89.1424 428.395 85.51C428.236 81.5336 425.12 76.5781 425.99 72.9832C414.123 71.8836 417.2 74.1637 412.511 74.3857C409.355 74.5351 402.854 70.7093 399.647 74.1132C397.542 76.3477 398.619 86.7028 397.971 90.0657Z"
                fill="#383838"
              />
            </g>
            <g id="finger_5">
              <path
                id="Vector_10"
                d="M376.615 164.919C373.169 160.497 369.201 156.753 368.257 151.22C367.261 145.379 369.866 139.428 367.009 133.807C364.756 129.376 359.969 127.029 357.113 123.145C352.92 117.445 352.094 107.147 328.603 109.192C317.118 110.192 313.182 118.473 318.682 128.398C321.619 133.698 328.337 135.785 331.116 141.43C333.01 145.278 332.156 150.098 335.663 153.526C338.964 156.753 342.234 156.199 344.01 161.338C345.709 166.257 344.368 167.513 348.015 171.933C351.303 175.917 356.875 177.707 359.671 181.432C361.114 183.355 361.631 185.872 362.782 187.4C361.944 186.288 365.388 184.78 365.076 185.965C364.497 186.262 364.162 186.745 364.072 187.417C365.079 188.696 366.719 185.767 368.499 186.905C369.692 187.667 369.686 187.986 371.3 190.552C378.008 194.632 373.469 185.615 373.34 184.487C372.385 176.157 385.311 176.078 376.615 164.919Z"
                fill="#383838"
              />
            </g>
          </g>
        </g>
        <g id="left">
          <g id="restHand_2">
            <path
              id="Vector_11"
              d="M201.553 129.841C201.563 126.975 204.042 123.672 203.733 120.877C203.611 119.762 200.926 119.813 200.675 118.555C200.455 117.457 201.278 115.906 200.9 114.953C200.101 112.94 201.686 112.478 198.969 111.238C195.669 109.732 196.645 112.466 194.299 112.851C193.241 113.025 191.402 114.812 190.392 114.506C189.536 114.246 189.743 110.589 188.944 110.358C184.495 109.07 182.709 112.808 179.882 115.933C173.779 122.677 178.317 121.808 176.726 128.145C175.996 131.05 172.506 133.753 172.777 136.702C172.913 138.173 175.793 138.803 176.537 139.686C177.479 140.801 176.71 142.908 177.827 143.698C180.129 145.325 188.151 144.687 190.884 145.229C193.789 145.805 199.655 148.972 201.852 143.727C206.741 137.038 201.53 136.972 201.553 129.841Z"
              fill="#5C5C5C"
            />
            <path
              id="Vector_12"
              d="M83.8716 149.022C86.6099 148.521 86.9842 147.773 89.7275 147.801C92.4366 147.829 90.4431 149.673 93.2391 149.596C97.1259 149.489 98.7746 146.065 101.769 148.257C104.637 147.121 101.022 146.038 101.099 144.96C101.482 139.567 105.358 144.271 102.441 126.738C100.784 116.776 98.1755 112.031 87.6103 111.374C81.4144 110.989 77.6649 110.299 74.1227 115.298C70.6917 120.14 69.4343 133.206 78.7532 128.82C81.6909 136.002 71.7155 151.246 83.8716 149.022Z"
              fill="#5C5C5C"
            />
            <path
              id="Vector_13"
              d="M120.01 136.667C120.078 152.807 146.672 146.194 149.522 138.248C150.442 135.685 148.637 133.031 149.101 130.463C149.551 127.974 152.083 126.11 152.591 123.541C153.241 120.257 151.404 117.641 150.507 114.718C149.096 110.118 150.709 106.787 150.551 102.503C150.222 93.5474 121.318 81.5281 118.733 93.3079C118.152 95.9571 121.018 97.8711 120.787 99.9361C120.49 102.599 118.912 102.827 117.136 105.873C116.631 106.737 113.891 112.503 113.854 113.492C113.599 120.319 116.878 114.375 120.809 116.022C122.526 116.742 117.42 125.688 117.748 127.507C118.154 129.766 121.345 130.627 121.54 132.318C121.816 134.702 120.005 135.449 120.01 136.667Z"
              fill="#5C5C5C"
            />
          </g>
          <g id="fingers_2">
            <g id="finger_6">
              <path
                id="Vector_14"
                d="M258.119 110.845C249.493 112.891 248.933 117.36 244.37 123.771C241.965 127.149 237.976 129.25 235.713 132.772C232.136 138.34 234.485 144.222 234.066 150.323C233.416 159.777 219.714 165.808 224.306 173.979C225.981 176.959 230.083 179.484 229.576 184.203C229.456 185.318 225.194 194.227 231.686 190.111C233.221 187.566 233.21 187.254 234.365 186.485C236.09 185.337 237.751 188.179 238.715 186.906C238.614 186.249 238.277 185.781 237.704 185.501C237.373 184.33 240.79 185.779 239.979 186.866C240.671 185.938 241.344 183.761 242.041 182.948C247.883 176.134 255.162 175.365 257.7 163.957C258.752 159.232 259.457 158.43 263.071 155.153C268.211 150.494 267.238 148.795 269.658 142.448C271.547 137.495 276.36 135.561 279.664 132.053C287.326 123.918 288.768 103.573 258.119 110.845Z"
                fill="#383838"
              />
            </g>
            <g id="finger_7">
              <path
                id="Vector_15"
                d="M180.349 102.948C184.294 107.953 195.416 112.072 199.092 104.651C204.095 111.982 210.311 103.093 207.971 92.0464C207.275 88.7611 208.142 78.5901 206.038 76.4379C202.832 73.1591 196.528 77.0278 193.432 76.9388C188.83 76.8064 191.805 74.5153 180.191 75.8084C181.11 79.3165 178.146 84.232 178.062 88.1327C177.984 91.6968 177.939 99.8889 180.349 102.948Z"
                fill="#383838"
              />
              <path
                id="Vector_16"
                d="M198.195 72.277C197.646 72.4907 201.753 68.3306 201.144 68.5886C206.153 66.4708 206.566 66.9909 208.568 61.0568C210.537 55.2184 212.513 49.9152 210.012 44.2635C208.279 40.3472 203.832 32.4005 200.139 30.4438C197.566 29.0807 187.34 27.4749 184.657 28.8044C180.554 30.8381 179.432 38.4872 179.023 43.1055C178.624 47.6175 177.156 54.3951 177.546 58.5541C178.33 66.9173 190.186 76.5196 198.195 72.277Z"
                fill="#383838"
              />
            </g>
            <g id="finger_8">
              <path
                id="Vector_17"
                d="M132.237 87.2779C134.637 87.378 136.82 87.0384 139.035 87.4081C141.548 87.8271 141.849 90.731 145.152 88.7761C148.281 86.9028 152.173 72.8886 151.822 68.8281C151.75 67.987 149.848 67.372 149.758 66.6402C149.45 64.1344 150.429 57.6303 148.606 54.103C147.816 52.5768 143.827 50.0606 143.682 48.9408C143.684 48.9543 148.476 49.2333 149.432 48.681C154.282 45.8789 159.029 7.36931 137.238 8.47172C134.539 8.60846 127.31 8.19989 125.158 9.37006C121.028 11.6157 116.579 25.0793 122.664 35.6146C123.837 37.6443 131.635 43.3601 131.399 43.7344C130.301 45.4716 122.564 41.0638 120.098 55.8413C117.49 71.4743 122.166 68.5255 122.564 71.2032C122.832 72.9985 114.324 86.5297 132.237 87.2779Z"
                fill="#383838"
              />
            </g>
            <g id="finger_9">
              <path
                id="Vector_18"
                d="M78.5708 106.468C79.8442 106.574 80.301 108.329 81.7368 108.728C93.9818 112.123 91.9798 103.028 94.6225 100.186C95.7136 99.0118 102.158 101.508 99.1987 89.7054C98.2392 85.8794 96.3643 84.4845 94.3487 81.0807C91.392 76.0876 94.2559 73.5467 93.7682 68.2375C93.2279 62.3561 90.6921 63.0867 92.1653 57.4407C93.5411 52.1674 95.1676 47.1515 95.8299 41.7994C100.374 5.08425 64.3051 15.5106 63.249 32.4939C60.7523 72.6558 70.9365 67.5358 79.6499 65.7705C79.9947 65.7007 88.721 64.9966 85.5896 68.2015C84.9062 68.9007 80.4379 67.7038 79.1209 68.1391C77.9677 68.5202 76.3288 70.9543 74.7936 71.6377C68.2357 74.5575 64.0217 72.2493 62.9321 81.7119C62.3075 87.1355 66.0607 90.4547 66.8826 95.5167C67.4538 99.0336 64.1093 105.363 68.9005 107.747C71.4449 109.012 75.8665 106.242 78.5708 106.468Z"
                fill="#383838"
              />
            </g>
            <g id="finger_10">
              <path
                id="Vector_19"
                d="M47.4536 178.455C50.508 177.316 50.3126 174.829 51.5434 172.431C51.6392 172.244 54.8099 173.696 55.089 173.516C56.2886 172.744 57.1073 171.543 57.9387 170.414C59.6647 168.07 59.3594 166.956 59.2834 164.247C58.8772 149.787 46.6503 145.855 46.1442 144.67C45.1078 142.244 48.08 143.802 48.068 141.643C47.9842 126.455 40.0217 120.743 34.6803 121.889C30.9646 122.686 33.0377 124.79 32.2875 125.347C30.6106 126.59 28.1506 126.855 26.0941 127.697C18.7878 130.687 21.7098 135.755 21.9906 142.983C22.3743 152.869 26.5678 168.083 36.9973 172.368C31.413 177.382 45.0489 178.764 47.4536 178.455Z"
                fill="#383838"
              />
              <path
                id="Vector_20"
                d="M23.0929 123.964C26.229 122.68 24.21 119.832 26.7639 118.07C29.2597 116.347 32.3459 117.159 34.7847 115.619C43.43 110.159 37.2241 102.322 36.8944 98.4749C36.5507 94.4644 38.3202 90.5148 37.9991 86.6505C36.9144 73.5908 9.68725 65.6738 10.9949 103.609C11.1769 108.885 13.61 110.377 15.4954 115.06C16.9426 118.654 16.6886 126.814 23.0929 123.964Z"
                fill="#383838"
              />
            </g>
          </g>
        </g>
      </g>
    </WrapperSVG>
  );
};
